"use strict";function addAxisGrid(){axis=new THREE.AxisHelper(2e3),scene.add(axis),grid=new THREE.GridHelper(2e3,100),helper=!1}function removeAxisGrid(){scene.remove(axis),scene.remove(grid),helper=!1}function onWindowResize(){camera.aspect=srcWidth/srcHeight,camera.updateProjectionMatrix(),modeVR?vrEffect.setSize(srcWidth,srcHeight):renderer.setSize(srcWidth,srcHeight)}function onkey(e){e.preventDefault(),90===e.keyCode?vrControl.zeroSensor():70===e.keyCode||13===e.keyCode?vrEffect.setFullScreen(!0):72===e.keyCode&&(rotest(),helper?removeAxisGrid():addAxisGrid())}function init(){clock=new THREE.Clock,renderer=new THREE.WebGLRenderer({antialias:!0}),vrEffect=new THREE.VREffect(renderer),vrEffect.setSize(srcWidth,srcHeight),renderer.setSize(srcWidth,srcHeight),container=document.getElementById("vrContainer"),container.appendChild(renderer.domElement),camera=new THREE.PerspectiveCamera(zoom,srcWidth/srcHeight),console.log("cameraDir",cameraDir),vrControl=new THREE.VRControls(camera),monoControl=new THREE.FirstPersonControls(camera,container),monoControl.lookSpeed=.1,monoControl.movementSpeed=0,monoControl.noFly=!0,monoControl.lookVertical=!0,monoControl.constrainVertical=!0,monoControl.verticalMin=1,monoControl.verticalMax=2,monoControl.lon=-160,monoControl.lat=160,scene=new THREE.Scene,addAxisGrid(),helper=!0,window.addEventListener("dblclick",function(){modeVR=!0,vrEffect.setFullScreen(!0)},!1),document.addEventListener("mozfullscreenchange",function(){null===document.mozFullScreenElement&&(modeVR=!1)}),window.addEventListener("resize",onWindowResize,!1);var e=document.getElementById("enterVR"),t=document.getElementById("getVR");VRClient.getVR.then(function(){t.classList.add("display-none")},function(){e.classList.add("display-none"),t.classList.remove("display-none")}),e.addEventListener("click",function(){modeVR=!0,vrEffect.setFullScreen(!0)},!1);var r=new THREE.SphereGeometry(100,32,16);video=document.createElement("video"),video.loop=!1,video.volume=.5;var n=document.createElement("canvas");n.width=srcWidth,n.height=srcHeight,videoContext=n.getContext("2d"),videoContext.fillStyle="#000000",videoContext.fillRect(0,0,n.width,n.height),texture=new THREE.Texture(n),texture.minFilter=THREE.LinearFilter,texture.flipY=!1;var o=new THREE.ShaderMaterial({uniforms:{tMatCap:{type:"t",value:texture},uvOffset:{type:"v4",value:new THREE.Vector4(0,0,0,0)},radius:{type:"f",value:.445}},vertexShader:shaders.vs.theta,fragmentShader:shaders.fs.theta,shading:THREE.SmoothShading,side:THREE.DoubleSide});o.uniforms.tMatCap.value.wrapS=o.uniforms.tMatCap.value.wrapT=THREE.ClampToEdgeWrapping;var a=new THREE.Mesh(r,o);a.rotation.x=Math.PI,a.rotation.x+=degree[0],a.rotation.y+=degree[1],a.rotation.z+=degree[2],scene.add(a)}function animate(){if(requestAnimationFrame(animate),video.readyState===video.HAVE_ENOUGH_DATA&&(videoContext.drawImage(video,0,0),texture&&(texture.needsUpdate=!0)),modeVR)vrControl.update(),vrEffect.render(scene,camera);else{var e=clock.getDelta();monoControl.update(e),renderer.render(scene,camera)}}function rotest(){console.log(camera.rotation.x,camera.rotation.y,camera.rotation.z)}var container,camera,scene,vrEffect,renderer,clock,vrControl,monoControl,video,videoContext,texture,helper,axis,grid,modeVR=!1,myStream,srcWidth=1280,srcHeight=720,d2r=function(e){return e*Math.PI/180},degree=[d2r(0),d2r(0),d2r(0)],firstview=d2r(0),pan=firstview,tilt=d2r(0),zoom=70,cameraDir=new THREE.Vector3(Math.sin(pan),Math.sin(tilt),Math.cos(pan)),shaders=new ShaderLoader("shaders");shaders.shaderSetLoaded=function(){init(),animate()},shaders.load("vs-theta","theta","vertex"),shaders.load("fs-theta","theta","fragment");